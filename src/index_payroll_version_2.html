<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8 /" content="Dans app">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Cache-control" content="description">
    <meta http-equiv="Set-Cookie" content="name, date">
    <meta name="description" content="Dan Weatherbee's Payroll in Backbone">
    <meta name="web_author" content="Dan Weatherbee Web Developer">
    <meta name="keywords" content="web developement,front end developement,front end web developement,danweatherbee,dan weatherbee,portfolio,dan weatherbee developer,danweatherby,dan weatherby,dan weatherbee web developer,dan weatherbee programmer,backbone.js">
    <meta name="author" content="Dan Weatherbee">
    <meta name="copyright" content="Dan Weatherbee">
    <meta name="contact" content="dan@jedi-clan.us">
    <meta name="reply-to" content="dan@jedi-clan.us">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#db5945">
    <meta name="msapplication-square310x310logo" content="favicon.ico">
  <title>Dan Weatherbee's payroll App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css">
  <link rel="stylesheet" href="assets/index_payroll_version_2.css">

</head>
<body>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
    <script src="js/lib/jquery-3.1.1.min.js"></script>


    <!-- https://mdbootstrap.com/css/animations/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script> -->

    <script src="js/lib/underscore-min.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script> -->

    <script src="js/lib/backbone-min.js"></script>


<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.1.16/backbone.localStorage-min.js"></script> -->

    <script src="js/lib/backbone-localstorage.min.js"></script>

<!--  While Bootstrap uses ems or rems for defining most sizes,
pxs are used for grid breakpoints and container widths.
This is because the viewport width is in pixels and does not change with the font size. -->


    <section class="container" id="main">

        <!-- Backbone Template===========================> -->

        <script type="text/template" id="app-template">
            <section class="sel-panel col-sm-12">
                <hr>
                <table>
                  <thead>
                    <tr>
                      <th>Qty</th>
                      <th>Rate</th>
                    </tr>
                  </thead>
                  <tbody>

                      <tr>
                        <td>
                        <select class="form-control" id="sel-qty">
                            <option>55</option>
                            <option>56</option>
                            <option>57</option>
                        </select>
                          </td>
                        <td>
                          <select class="form-control" id="sel-rate">

                            <option>15</option>
                            <option>16</option>
                          </select>
                        </td>
                      </tr>
                  </tbody>
                </table>
                <button class="btn btn-primary btn-print">Save to PDF</button>
            </section>
        </script>
<!-- Backbone Template===========================> -->
        <!-- // <script type="text/template" id="pay-stub-template"> -->
            <section class="stub-panel col-sm-12">

                <h3>Employee</h3>
                <hr>
                <h4 id="employee">Dan</h4>
                <table>
                  <thead>
                    <tr>
                      <th>Earnings & Hours</th>
                      <th>Qty</th>
                      <th>Rate</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>Hourly Rate</td>
                        <td id="qty-hr-stub"></td>
                        <td id="rate-hr-stub"></td>
                        <td id="cur-hr-stub"></td>
                        <td id="ytd-hr-stub"></td>
                      </tr>
                      <tr>
                        <td>Over Time</td>
                        <td id="qty-ot-stub"></td>
                        <td id="rate-ot-stub"></td>
                        <td id="cur-ot-stub"></td>
                        <td id="ytd-ot-stub"></td>
                      </tr>
                      <tr>
                        <td>VacPay Pay Out</td>
                        <td id="qty-vac-stub"></td>
                        <td id="rate-vac-stub"></td>
                        <td id="cur-vac-stub"></td>
                        <td id="ytd-vac-stub"></td>
                      </tr>
                      <tr>
                        <td></td>
                        <td id="qty-vacP-stub"></td>
                        <td id="rate-vacP-stub"></td>
                        <td id="cur-vacP-stub"></td>
                        <td id="ytd-vacP-stub"></td>
                      </tr>
                  </tbody>
                </table>
                <hr>
               <table>
                  <thead>
                    <tr>
                      <th>Withholdings</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>CPP-Employee</td>
                        <td id="cur-cpp-stub"></td>
                        <td id="ytd-cpp-stub"></td>
                      </tr>
                      <tr>
                        <td>EI-Employee</td>
                        <td id="cur-ei-stub"></td>
                        <td id="ytd-ei-stub"></td>
                      </tr>
                      <tr>
                        <td>Federal Income Tax</td>
                        <td id="cur-fed-stub"></td>
                        <td id="ytd-fed-stub"></td>
                      </tr>
                      <tr>
                        <td>Provincial Income Tax</td>
                        <td id="cur-pro-stub"></td>
                        <td id="ytd-pro-stub"></td>
                      </tr>
                      <tr>
                        <td></td>
                        <td id="cur-tot-stub"></td>
                        <td id="ytd-tot-stub"></td>
                      </tr>
                  </tbody>
                </table>
                <hr>
               <table>
                  <thead>
                    <tr>

                      <th>Net Pay</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td></td>
                        <td id="cur-netPay-stub"></td>
                        <td id="ytd-netPay-stub"></td>
                      </tr>
                  </tbody>
                </table>
            </section>
<!--         </script> -->
<!-- Backbone Template===========================> -->
        <script type="text/template" id="trans-template">
            <section class="sel-panel col-sm-12">
                <hr>
                <h3 id="total-models"></h3>
                <table>
                  <thead>
                    <tr>
                      <th>Qty</th>
                      <th>Rate</th>
                      <th>Current</th>
                      <th>Vac</th>
                      <th>Gross</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td id="qty"></td>
                        <td id="rate"></td>
                        <td id="cur"></td>
                        <td id="vac"></td>
                        <td id="gross"></td>
                      </tr>
                  </tbody>
                </table>
                <button class="btn btn-primary btn-add" data-test= "">Add data</button>
            </section>
        </script>
     <!--    <img id="img-temp" src="template.png"></img> -->

    </section>






    <script>
        // Global Constants
        var TIME = new Date();
        var D = TIME.getDay();
        var M = TIME.getMonth();
        var Y = TIME.getFullYear();

        /*global $ */
        /*jshint unused:false */
        var app = app || {};
        var ENTER_KEY = 13;
        var ESC_KEY = 27;




        Model = Backbone.Model.extend({
            qty: 15

        });


        Collection = Backbone.Collection.extend({
            model: Model,
            localStorage: new Backbone.LocalStorage('payroll'),
            populate: function () {

                var count = 0;
                var ytd = 0;

                for (var i = 0;i < collection.models.length; i++) {

                    count = count + collection.models[i].attributes.qty
                    ytd = ytd + collection.models[0].attributes.cur


                    $('#qty').prepend('<p>' + collection.models[i].attributes.qty + '</p><hr>');

                    $('#rate').prepend('<p>' + collection.models[i].attributes.rate + '</p><hr>');
                    $('#cur').prepend('<p>' + collection.models[i].attributes.cur + '</p><hr>');

                    $('#vac').prepend('<p>' + collection.models[i].attributes.vac + '</p><hr>');
                    $('#gross').prepend('<p>' + collection.models[i].attributes.gross + '</p><hr>');

                }
                $('#total-models').append("Total Transactions in collection: " + collection.models.length);
                $('#qty-hr-stub').html(count);
                $('#rate-hr-stub').html(collection.models[collection.models.length - 1].attributes.rate);
                $('#cur-hr-stub').html(collection.models[0].attributes.cur);
                $('#ytd-hr-stub').html(ytd);
            }
        });

        collection = new Collection();


        AppView = Backbone.View.extend({
            el: '.container',
            appTemplate: _.template($('#app-template').html()),
            events: {
                'click [data-test]': 'addData'
            },
            initialize: function () {

                collection.fetch();



            this.listenTo(collection, 'populate', this.addData);

            // Suppresses 'add' events with {reset: true} and prevents the app view
            // from being re-rendered for every model. Only renders when the 'reset'
            // event is triggered at the end of the fetch.
            // app.todos.fetch({reset: true});

            this.render();
            },

            addData: function () {

                var QTY = Number($('#sel-qty option:selected').text());
                var RATE = Number($('#sel-rate option:selected').text());

                var CUR = QTY * RATE;

                var VAC = CUR * .04;

                var GROSS = CUR + VAC;



                var TransModel = {
                    qty: QTY,
                    rate: RATE,
                    cur: CUR,
                    vac: VAC,
                    gross: GROSS
                    };



                var newTrans = new Model(TransModel);


                collection.add(newTrans);

                newTrans.save();






            },

            // Re-rendering the App just means refreshing the statistics -- the rest
            // of the app doesn't change.
            render: function () {


                this.$el.prepend(this.appTemplate);



            }

        });


        var app = new AppView();


        PayrollView = Backbone.View.extend({



            el: '.container',
            transTemplate: _.template($('#trans-template').html()),
            events: {
                'click [data-test]': 'reload'

            },


            initialize: function() {


                collection.fetch();


                this.render();
        },
        render: function () {
            this.$el.append(this.transTemplate);
            collection.populate();
        },
        reload: function () {
            location.reload();

        }

        });

        var pay = new PayrollView();

/*
Events is a module that can be mixed in to any object, giving the object the ability to bind and trigger custom named events. Events do not have to be declared before they are bound, and may take passed arguments. For example:

var object = {};

_.extend(object, Backbone.Events);

object.on("alert", function(msg) {
  alert("Triggered " + msg);
});

object.trigger("alert", "an event")
*/
    </script>
</body>
</html>