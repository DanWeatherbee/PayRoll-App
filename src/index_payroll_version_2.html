<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8 /" content="Dans app">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Cache-control" content="description">
    <meta http-equiv="Set-Cookie" content="name, date">
    <meta name="description" content="Dan Weatherbee's Payroll in Backbone">
    <meta name="web_author" content="Dan Weatherbee Web Developer">
    <meta name="keywords" content="web developement,front end developement,front end web developement,danweatherbee,dan weatherbee,portfolio,dan weatherbee developer,danweatherby,dan weatherby,dan weatherbee web developer,dan weatherbee programmer,backbone.js">
    <meta name="author" content="Dan Weatherbee">
    <meta name="copyright" content="Dan Weatherbee">
    <meta name="contact" content="dan@jedi-clan.us">
    <meta name="reply-to" content="dan@jedi-clan.us">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#db5945">
    <meta name="msapplication-square310x310logo" content="favicon.ico">
  <title>Dan Weatherbee's payroll App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css">
  <link rel="stylesheet" href="assets/index_payroll_version_2.css">

</head>
<body>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
    <script src="js/lib/jquery-3.1.1.min.js"></script>

  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- https://mdbootstrap.com/css/animations/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script> -->

    <script src="js/lib/underscore-min.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script> -->

    <script src="js/lib/backbone-min.js"></script>


<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.1.16/backbone.localStorage-min.js"></script> -->

    <script src="js/lib/backbone-localstorage.min.js"></script>

<!--  While Bootstrap uses ems or rems for defining most sizes,
pxs are used for grid breakpoints and container widths.
This is because the viewport width is in pixels and does not change with the font size. -->
    <div class="container" id="main">
      <section class="last-trans-panel col-sm-12">
        <h3 id="last-tran-header">Last Transaction:</h3>
          <table>
            <thead>
              <tr>
                <th>Job</th>
                <th>Date</th>
                <th>Qty</th>
                <th>Rate</th>
                <th>Current</th>
                <th>Vac</th>
                <th>Gross</th>
                <th>Stat</th>
              </tr>
            </thead>
            <tbody>
                <tr>
                  <td id="job-l"></td>
                  <td id="dte-l"></td>
                  <td id="qty-l"></td>
                  <td id="rate-l"></td>
                  <td id="cur-l"></td>
                  <td id="vac-l"></td>
                  <td id="gross-l"></td>
                  <td id="stat-l"></td>
                </tr>
            </tbody>
          </table>
      </section>


      <section class="pay-period-panel col-sm-12">
          <h3 id="pay-per-header">Pay Period Panel:</h3>
          <hr>
          <label for="from">From</label>
          <input type="text" id="from" name="from" placeholder="Calender">
          <label for="to">to</label>
          <input type="text" id="to" name="to" placeholder="Calender">
          <hr>
      </section>

        <!-- Backbone Template===========================> -->
        <script type="text/template" id="app-template">
            <section class="sel-panel col-sm-12">
                <hr>
                <table>
                  <thead>
                    <tr>
                      <th>Job</th>
                      <th>Date</th>
                      <th>Qty(hours)</th>
                      <th>Rate</th>
                      <th>OT(hours)</th>
                      <th>Stat</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>
                            <input type="text" id="job-opt" placeholder="Enter Job">
                        </td>
                        <td>
                          <input type="text" id="datepicker" placeholder="Calender">
                        </td>

                        <td>
                        <select class="form-control" id="sel-qty">
                        </select>
                        </td>
                        <td>
                          <select class="form-control" id="sel-rate">
                          </select>
                        </td>
                        <td>
                          <select class="form-control" id="sel-ot">
                          </select>
                        </td>
                        <td>
                          <select class="form-control" id="sel-stat">
                            <option>No Stat</option>
                            <option>New Years Day</option>
                            <option>Family Day</option>
                            <option>Good Friday Day</option>
                            <option>Victoria Day</option>
                            <option>Canada Day</option>
                            <option>BC Day</option>
                            <option>Labour Day</option>
                            <option>Thanksgiving Day</option>
                            <option>Remembrance Day</option>
                            <option>Christmas Day</option>
                          </select>
                        </td>
                      </tr>
                  </tbody>
                </table>
                <button class="btn btn-primary btn-print">Save to PDF</button>

            </section>
        </script>
<!-- Backbone Template===========================> -->
        <!-- // <script type="text/template" id="pay-stub-template"> -->
            <section class="stub-panel col-sm-12">
                <h3 id="employee-h">Employee</h3>
                <hr>
                <select class="form-control" id="sel-emp">
                      <option>Dan</option>
                      <option>Tina</option>
                </select>
                <hr>
                <table>
                  <thead>
                    <tr>
                      <th>Earnings & Hours</th>
                      <th>Qty</th>
                      <th>Rate</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>Hourly Rate</td>
                        <td id="qty-hr-stub"></td>
                        <td id="rate-hr-stub"></td>
                        <td id="cur-hr-stub"></td>
                        <td id="ytd-hr-stub"></td>
                      </tr>
                      <tr>
                        <td>Over Time</td>
                        <td id="qty-ot-stub"></td>
                        <td id="rate-ot-stub"></td>
                        <td id="cur-ot-stub"></td>
                        <td id="ytd-ot-stub"></td>
                      </tr>
                      <tr>
                        <td>VacPay Pay Out</td>
                        <td id="qty-vac-stub"></td>
                        <td id="rate-vac-stub"></td>
                        <td id="cur-vac-stub"></td>
                        <td id="ytd-vac-stub"></td>
                      </tr>
                      <tr>
                        <td></td>
                        <td id="qty-vacP-stub"></td>
                        <td id="rate-vacP-stub"></td>
                        <td id="cur-vacP-stub"></td>
                        <td id="ytd-vacP-stub"></td>
                      </tr>
                  </tbody>
                </table>
                <hr>
               <table>
                  <thead>
                    <tr>
                      <th>Withholdings</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>CPP-Employee</td>
                        <td id="cur-cpp-stub"></td>
                        <td id="ytd-cpp-stub"></td>
                      </tr>
                      <tr>
                        <td>UI-Employee</td>
                        <td id="cur-ui-stub"></td>
                        <td id="ytd-ui-stub"></td>
                      </tr>
                      <tr>
                        <td>Federal Income Tax</td>
                        <td id="cur-fed-stub"></td>
                        <td id="ytd-fed-stub"></td>
                      </tr>

                      <tr>
                        <td></td>
                        <td id="cur-tot-stub"></td>
                        <td id="ytd-tot-stub"></td>
                      </tr>
                  </tbody>
                </table>
                <hr>
               <table>
                  <thead>
                    <tr>

                      <th>Net Pay</th>
                      <th>Current</th>
                      <th>YTD Amount Estimate</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td></td>
                        <td id="cur-netPay-stub"></td>
                        <td id="ytd-netPay-stub"></td>
                      </tr>
                  </tbody>
                </table>
            </section>
<!--         </script> -->
<!-- Backbone Template===========================> -->
        <script type="text/template" id="trans-template">
            <section class="sel-panel-tran col-sm-12">
                <hr>
                <h3 id="total-models"></h3>
                <table>
                  <thead id="trans-table-head">
                    <tr>
                      <th>Job</th>
                      <th>Date</th>
                      <th>Qty</th>
                      <th>Rate</th>
                      <th>Current</th>
                      <th>Vac</th>
                      <th>Gross</th>
                      <th>Stat</th>
                    </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td id="job"></td>
                        <td id="dte"></td>
                        <td id="qty"></td>
                        <td id="rate"></td>
                        <td id="cur"></td>
                        <td id="vac"></td>
                        <td id="gross"></td>
                        <td id="stat"></td>
                      </tr>
                  </tbody>
                </table>
                <button class="btn btn-primary btn-add" data-test= "">Add data</button>
            </section>
        </script>
        <button class="btn btn-primary btn-del">Delete data</button>
        <!-- <img id="img-temp" src="template.png"></img> -->
        <a href="http://www.cra-arc.gc.ca/tx/llrts/menu-eng.html" id="link-canada">Canada Revenue Calculations</a>

    </div>
    <script>
        // Global Constants
        var TIME = new Date();
        var D = TIME.getDay();
        var M = TIME.getMonth();
        var Y = TIME.getFullYear();

        /*global $ */
        /*jshint unused:false */
        var app = app || {};
        var ENTER_KEY = 13;
        var ESC_KEY = 27;
        var totalQty = 0;
        var totalYtd = 0;
        var totalVac = 0;
        var totalCur = 0;
        var pay;
        var fed;
        var totalTax;
        var cpp;
        var ui;
        var totalUIplusCPP;
        var totalAllDeductions;
        var netPay;
        var payStart;
        var payEnd;


        $( function() {
          $('#pay-per-header').append(" " + '<span style="color: red;">Please enter a pay period.</span>')
          var dateFormat = "mm/dd/yy",
            from = $( "#from" )
              .datepicker({
                defaultDate: "+1w",
                changeMonth: true,
                numberOfMonths: 2
              })
              .on( "change", function() {
                to.datepicker( "option", "minDate", getDate( this ) );
              }),
            to = $( "#to" ).datepicker({
              defaultDate: "+1w",
              changeMonth: true,
              numberOfMonths: 2
            })
            .on( "change", function() {
              from.datepicker( "option", "maxDate", getDate( this ) );

            });

          function getDate( element ) {

            try {
              DATE = $.datepicker.parseDate( dateFormat, element.value );
            } catch( error ) {

              DATE = null;
            }
            return DATE;
          };
        } );

        Model = Backbone.Model.extend({
            qty: 15
        });


        Collection = Backbone.Collection.extend({
            model: Model,
            localStorage: new Backbone.LocalStorage('payroll'),

            /*
             Grab all the data from collections saved in local storage.
             Populate the DOM with the retrieved information.
             */
            populate: function () {


                for (var i = 0;i < 200; i++) {
                    $('#sel-qty').append('<option>' + i + '</option>');
                    $('#sel-qty').append('<option>' + (i + .5) + '</option>');
                    $('#sel-rate').append('<option>' + i + '</option>');
                    $('#sel-rate').append('<option>' + (i + .5) + '</option>');
                    $('#sel-ot').append('<option>' + i + '</option>');
                    $('#sel-ot').append('<option>' + (i + .5) + '</option>');
                }

                for (var i = 0;i < collection.models.length; i++) {
                    $('#sel-qty').append('<option>' + i + '</option>');

                    totalQty = totalQty + collection.models[i].attributes.qty;
                    totalYtd = totalYtd + collection.models[i].attributes.cur;
                    totalVac = totalVac + collection.models[i].attributes.vac;
                    totalCur = totalCur + collection.models[i].attributes.cur;
                    $('#job').prepend('<p>' + collection.models[i].attributes.job + '</p><hr>');
                    $('#dte').prepend('<p>' + collection.models[i].attributes.dte + '</p><hr>');
                    $('#qty').prepend('<p>' + collection.models[i].attributes.qty + '</p><hr>');
                    $('#rate').prepend('<p>' + collection.models[i].attributes.rate + '</p><hr>');
                    $('#cur').prepend('<p>' + collection.models[i].attributes.cur + '</p><hr>');
                    var vac_2DIGITS = collection.models[i].attributes.vac;
                    $('#vac').prepend('<p>' + vac_2DIGITS.toFixed(2) + '</p><hr>');
                    $('#gross').prepend('<p>' + collection.models[i].attributes.gross + '</p><hr>');
                    $('#stat').prepend('<p>' + collection.models[i].attributes.stat + '</p><hr>');
                }

                payStart = collection.models[0].attributes.periodB;

                payEnd = collection.models[0].attributes.periodE;
                $('.pay-period-panel').fadeOut();

                var dateNow = Date();
                $('#pay-per-header').append(" Today is " + dateNow + " Choose a pay period below.");
                $('#employee-h').html(" Period start: " + payStart + " Period end: " + payEnd);
                $('#total-models').append("Total Transactions in collection: " + collection.models.length);
                $('#qty-hr-stub').html(totalQty);
                $('#rate-hr-stub').html(collection.models[collection.models.length - 1].attributes.rate);
                $('#cur-hr-stub').html(totalCur);
                $('#cur-vac-stub').html(totalVac.toFixed(2));
                $('#ytd-hr-stub').html(totalYtd);
                $('#ytd-vac-stub').html(totalVac.toFixed(2));
                $('#cur-vacP-stub').html(totalCur + totalVac);
                $('#ytd-vacP-stub').html(totalCur + totalVac);
                $('#dte-l').html(collection.models[collection.models.length - 1].attributes.dte);
                $('#qty-l').html(collection.models[collection.models.length - 1].attributes.qty);
                $('#rate-l').html(collection.models[collection.models.length - 1].attributes.rate);
                $('#cur-l').html(collection.models[collection.models.length - 1].attributes.cur);
                var VAC_2DIGITS = collection.models[collection.models.length - 1].attributes.vac;
                $('#vac-l').html(VAC_2DIGITS.toFixed(2));
                $('#gross-l').html(collection.models[collection.models.length - 1].attributes.gross);
                $('#stat-l').html(collection.models[collection.models.length - 1].attributes.stat);
                $('#job-l').html(collection.models[collection.models.length - 1].attributes.job);
                $('#job-opt')[0].value = collection.models[collection.models.length - 1].attributes.job;

                $('#sel-qty').prepend('<option>' +
                  collection.models[collection.models.length - 1].attributes.qty + '</option>');
                $('#sel-rate').prepend('<option>' +
                  collection.models[collection.models.length - 1].attributes.rate + '</option>');
                $('#sel-ot').prepend('<option>' +
                  collection.models[collection.models.length - 1].attributes.ot + '</option>');
                $('#sel-stat').prepend('<option>' +
                  collection.models[collection.models.length - 1].attributes.stat + '</option>');

                pay = totalCur + totalVac;

                // 2017 Tax Calculations.
                if (pay > 0) {

                  fed = pay * 0.014;
                  totalTax = fed
                  cpp = pay * 0.0495;
                  ui = pay * 0.0163;
                  totalUIplusCPP = cpp + ui;
                  totalAllDeductions = totalTax + totalUIplusCPP;
                  netPay = pay - totalAllDeductions;

                  // Append Calculated Data received from collections.
                  $('#cur-netPay-stub').html(netPay.toFixed(2));
                  $('#ytd-netPay-stub').html(netPay.toFixed(2));
                  $('#cur-cpp-stub').html('- ' + cpp.toFixed(2));
                  $('#cur-ui-stub').html('- ' + ui.toFixed(2));
                  $('#cur-fed-stub').html('- ' + fed.toFixed(2));
                  $('#cur-tot-stub').html('- ' + (totalTax + totalUIplusCPP).toFixed(2));
                  $('#ytd-cpp-stub').html('- ' + cpp.toFixed(2));
                  $('#ytd-ui-stub').html('- ' + ui.toFixed(2));
                  $('#ytd-fed-stub').html('- ' + fed.toFixed(2));
                  $('#ytd-tot-stub').html('- ' + (totalTax + totalUIplusCPP).toFixed(2));


                }


            }

        });

        collection = new Collection();

        AppView = Backbone.View.extend({
            el: '.container',
            appTemplate: _.template($('#app-template').html()),
            events: {
                'click [data-test]': 'addData'
            },
            initialize: function () {

              collection.fetch();

              this.listenTo(collection, 'populate', this.addData);
              this.render();
            },

            addData: function () {
   $('#job').append('<p>' + collection.models[collection.models.length - 1].attributes.job + '</p><hr>');
                // Grab data from Date Elements.
                var DATE_PERIOD_BEGIN = $('#from')[0].value;
                var DATE_PERIOD_END = $('#to')[0].value;
                var DATE = $('#datepicker')[0].value;
                var JOB = $('#job-opt')[0].value;


                // Make sure Date Element is not empty.
                if (JOB == "") {
                  alert("please enter a job and date.")
                  return;
                }
                if (DATE == "") {
                  alert("please enter a job and date.")
                  return;
                }
                if (!DATE_PERIOD_BEGIN == "") {
                  $('#pay-per-header').html("Pay Period Panel: ");

                }
                if (!DATE_PERIOD_END == "") {
                  $('#pay-per-header').html("Pay Period Panel: ");

                }
                // Grab values from options selected.
                var QTY = Number($('#sel-qty option:selected').text());
                var RATE = Number($('#sel-rate option:selected').text());
                var CUR = QTY * RATE;
                var VAC = CUR * .04;
                var GROSS = CUR + VAC;
                var STAT = $('#sel-stat option:selected').text();

                // Transaction Model.
                var TransModel = {
                    dte: DATE,
                    qty: QTY,
                    rate: RATE,
                    cur: CUR,
                    vac: VAC,
                    gross: GROSS,
                    stat: STAT,
                    periodB: DATE_PERIOD_BEGIN,
                    periodE: DATE_PERIOD_END,
                    job: JOB
                    };

                var newTrans = new Model(TransModel);

                collection.add(newTrans);

                // Save the new transaction, views will rely on collections for data.
                newTrans.save();
            },
            clear: function () {
              collection.each(function(model) {
              model.destroy();
              });

            },

            // Re-rendering the App just means refreshing the statistics -- the rest
            // of the app doesn't change.
            render: function () {
                this.$el.prepend(this.appTemplate);

            }

        });

        var app = new AppView();

        PayrollView = Backbone.View.extend({

            el: '.container',
            transTemplate: _.template($('#trans-template').html()),
            events: {
                'click [data-test]': 'reload'
            },

            initialize: function() {

                $('#datepicker').datepicker({
              defaultDate: "+1w",
              changeMonth: true,
              numberOfMonths: 2
            });
                collection.fetch();
                this.render();
        },
        render: function () {
            this.$el.append(this.transTemplate);

            collection.populate();
        },
        reload: function () {
            location.reload();
        }

        });

        var payRoll = new PayrollView();

        $('.btn-print').click(function() {

            $('.option-panel').hide();
            $('.btn-print').hide();
            $('.btn-add').hide();
            $('.btn-del').hide();
            $('.sel-panel').hide();
            $('.last-trans-panel').hide();
            $('.stub-panel').hide();
            $('#link-canada').hide();

            $('#trans-table-head').hide();
            // $('#job').hide();
            // $('#dte').hide();
            // $('#qty').hide();
            $('#rate').hide();
            $('#cur').hide();

            $('#vac').hide();
            $('#gross').hide();
            // $('#stat').hide();



            var sign = prompt("What's your username?");

            if (sign.toLowerCase() == "tina") {
              alert("He Beh beh's wuz up!");

              window.print();
            }
            else if (sign.toLowerCase() == "dan") {
              alert("Hi Master I love you!");

              window.print();

            }
            else {
             alert("Sorry I don't know you.");
             reload();
            }


        });
        $('.btn-del').click(function() {

            app.clear();
            location.reload();

        });
/*
Events is a module that can be mixed in to any object, giving the object the ability to bind and trigger custom named events. Events do not have to be declared before they are bound, and may take passed arguments. For example:

var object = {};

_.extend(object, Backbone.Events);

object.on("alert", function(msg) {
  alert("Triggered " + msg);
});

object.trigger("alert", "an event")
*/
    </script>
</body>
</html>