<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8 /" content="Dans app">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Cache-control" content="description">
    <meta http-equiv="Set-Cookie" content="name, date">
    <meta name="description" content="Dan Weatherbee's Payroll in Backbone">
    <meta name="web_author" content="Dan Weatherbee Web Developer">
    <meta name="keywords" content="web developement,front end developement,front end web developement,danweatherbee,dan weatherbee,portfolio,dan weatherbee developer,danweatherby,dan weatherby,dan weatherbee web developer,dan weatherbee programmer,backbone.js">
    <meta name="author" content="Dan Weatherbee">
    <meta name="copyright" content="Dan Weatherbee">
    <meta name="contact" content="dan@jedi-clan.us">
    <meta name="reply-to" content="dan@jedi-clan.us">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#db5945">
    <meta name="msapplication-square310x310logo" content="favicon.ico">
  <title>Dan Weatherbee's payroll App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css">
  <link rel="stylesheet" href="assets/index_payroll.css">

</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- https://mdbootstrap.com/css/animations/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.1.16/backbone.localStorage-min.js"></script>

<!--  While Bootstrap uses ems or rems for defining most sizes,
pxs are used for grid breakpoints and container widths.
This is because the viewport width is in pixels and does not change with the font size. -->

    <div class="container">
            <section class="header">
                <h1>Dan Weatherbee's Payroll App</h1>
                <h4>Front End Web Developer</h4>
                <button onclick="reload()" class="btn btn-primary new-sheet">Start Over</button>
            </section>
            <section class="col-sm-12 option-panel">

                  <label for="sel-1">Select Job:</label>
                  <select class="form-control" id="sel-1">
                    <option>CIBC Tower</option>
                    <option>CIBC Downtown</option>
                    <option>CIBC Mall</option>
                    <option>Telus</option>
                    <option>HSBC</option>
                    <option>The Bay</option>
                  </select>



                  <label for="sel-2">Select Day:</label>
                  <select class="form-control" id="sel-2">
                    <option>Mon</option>
                    <option>Tue</option>
                    <option>Wed</option>
                    <option>Thu</option>
                    <option>Fri</option>
                    <option>Sat</option>
                    <option>Sun</option>
                  </select>



                  <label for="sel-3">Select Month:</label>
                  <select class="form-control" id="sel-3">
                    <option>Jan</option>
                    <option>Feb</option>
                    <option>Mar</option>
                    <option>Apr</option>
                    <option>May</option>
                    <option>Jun</option>
                    <option>Jul</option>
                    <option>Aug</option>
                    <option>Sep</option>
                    <option>Oct</option>
                    <option>Nov</option>
                    <option>Dec</option>
                  </select>



                  <label for="sel-4">Select Year:</label>
                  <select class="form-control" id="sel-4">
                    <option>2017</option>
                    <option>2018</option>
                    <option>2019</option>
                    <option>2020</option>
                  </select>



                  <label for="sel-5">Select Hours:</label>
                  <select class="form-control" id="sel-5">
                    <option value="1">1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>1.5</option>
                    <option>2.5</option>
                    <option>3.5</option>
                    <option>4.5</option>
                    <option>5.5</option>
                    <option>6.5</option>
                    <option>7.5</option>
                    <option>8.5</option>
                    <option>9.5</option>
                  </select>

                  <label for="sel-6">Select Date:</label>
                  <select class="form-control" id="sel-6">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>11</option>
                    <option>12</option>
                    <option>13</option>
                    <option>14</option>
                    <option>15</option>
                    <option>16</option>
                    <option>17</option>
                    <option>18</option>
                    <option>19</option>
                    <option>20</option>
                    <option>21</option>
                    <option>22</option>
                    <option>23</option>
                    <option>24</option>
                    <option>25</option>
                    <option>26</option>
                    <option>27</option>
                    <option>28</option>
                    <option>29</option>
                    <option>30</option>
                    <option>31</option>
                  </select>

                  <label for="sel-7">Select Employee:</label>
                  <select class="form-control" id="sel-7">
                    <option>Dan</option>
                    <option>Tina</option>
                  </select>

                  <label for="sel-8">Select Rate:</label>
                  <select class="form-control" id="sel-8">
                    <option>14</option>
                    <option>15</option>
                    <option>16</option>
                  </select>

            </div>
            <section class="col-sm-12 tax-panel">
                <div class="col-sm-12 shadow tax-container">
                    <p class="transactions">Total Days:</p>
                    <p class="fed">Fed Tax:</p>
                    <p class="pro">Pro Tax:</p>
                    <p class="total-tax">Total Tax:</p>
                    <p class="cpp">CPP:</p>
                    <p class="ui">UI:</p>
                    <p class="total-cppui">Total CPP/UI:</p>
                    <p class="total-deductions">Total Tax + CPP/UI:</p>
                    <p class="vac-pay">Vacation Pay:</p>
                    <p class="gross-pay">Gross Pay:</p>
                    <p class="gross-vac-pay">Gross/Vac Total Pay:</p>
                    <p class="net-pay">Net Pay:</p>
                    <p class="net-vac-pay">Net/Vac Total:</p>
                </div>

                <nav>
                    <div class="col-sm-12" id="data-container">
                        
                        <button class="btn btn-primary btn-add">Add data</button>
                        <button class="btn btn-primary btn-print">Save to PDF</button>


                    </div>
                </nav>

            </section>
            <footer>
                <h3 class="performance">

                </h3>
            </footer>
    </div>
    <script>
        var t0 = performance.now();
          /*
             getMonth bug http://stackoverflow.com/questions/18624326/
             getmonth-in-javascript-gives-last-month

             Fix
             var d = new Date();
             b.getMonth() + 1;
            */

        // Created a Date Object
        var calender = new Date();
        var M = calender.getMonth() + 1;
        var Y = calender.getFullYear();
        var D = calender.getDay();


        // Cache jQuery elements for performance.
        var $elTransactions = $('.transactions');
        var $elFed = $('.fed');
        var $elPro = $('.pro');
        var $elTotalTax = $('.total-tax');
        var $elCPP = $('.cpp');
        var $elUI = $('.ui');
        var $elTotalCPPUI = $('.total-cppui');
        var $elTotalDed = $('.total-deductions');
        var $elPerformance = $('.performance');
        var $elVacPay = $('.vac-pay');
        var $elNetPay = $('.net-pay');
        var $elGrossPay = $('.gross-pay');
        var $elGrossVacPay = $('.gross-vac-pay');
        var $elNetVacPay = $('.net-vac-pay');
        var $elTaxContainer = $('.tax-container');
        var DEFAULT = " $0.00";

        $elTransactions.append(DEFAULT);
        $elFed.append(DEFAULT);
        $elPro.append(DEFAULT);
        $elTotalTax.append(DEFAULT);
        $elCPP.append(DEFAULT);
        $elUI.append(DEFAULT);
        $elTotalCPPUI.append(DEFAULT);
        $elTotalDed.append(DEFAULT);
        $elPerformance.append(DEFAULT);
        $elVacPay.append(DEFAULT);
        $elGrossPay.append(DEFAULT);
        $elGrossVacPay.append(DEFAULT);
        $elNetPay.append(DEFAULT);
        $elNetVacPay.append(DEFAULT);
        var count = 0;
        var grossPay = 0;
        var totalDays = 0;
        var vacPay = 0;
        var netVacPay = 0;
        var days = 0;

        $('.new-sheet').hide();        
        $('.btn-print').hide();
        $elTaxContainer.hide();

        $('.btn-add').click(function() {
            days++;
            $('.new-sheet').fadeIn();
            var data_job = $('#sel-1 option:selected').text();
            
            switch (D) {
                case 0:
                    day = "Sunday";
                    break;
                case 1:
                    day = "Monday";
                    break;
                case 2:
                    day = "Tuesday";
                    break;
                case 3:
                    day = "Wednesday";
                    break;
                case 4:
                    day = "Thursday";
                    break;
                case 5:
                    day = "Friday";
                    break;
                case 6:
                    day = "Saturday";
            }
            var data_day = $('#sel-2 option:selected').html(day);
            var data_month = $('#sel-3 option:selected').html(M);
            var data_year = $('#sel-4 option:selected').html(Y);
            var data_hours = Number($('#sel-5 option:selected').text());
            count = count + data_hours; 
            var data_date = $('#sel-6 option:selected').text();
            var data_employee = $('#sel-7 option:selected').text();
            var data_rate = Number($('#sel-8 option:selected').text());
            var dataHtml = '<table class="data-table"><thead><tr><th>Employee<th>Year<th>Month<th>' +
            'Day<th>Date<th>Hours<th>Job<tbody><tr><td>' + data_employee + '<td>' + data_year +
            '<td>' + data_month + '<td>' + data_day +
             '<td>' + data_date + '<td id="hours">' + data_hours +
              '<td>' + data_job + '</table>Entry Date: ' + Date();
            console.log(dataHtml);
            count + Number(data_hours);
            grossPay = count * data_rate;
            vacPay = grossPay * .04;
            var grossVacPay = grossPay + vacPay;
            var totalDeductions = deductions(grossPay);
            var netPay = grossVacPay - totalDeductions;

            var projYearlyTotalNetPay = netPay * 26;
            
            $('#data-container').prepend('<hr>' + dataHtml + "Estimated year end: " + projYearlyTotalNetPay);
            $('.btn-print').fadeIn();
            $('#total-container').fadeIn();
            $elTaxContainer.fadeIn();
        });

        $('.btn-print').click(function() {
            totalHours();
            var sign = prompt("What's your username?");

            if (sign.toLowerCase() == "tina") {
              alert("He Beh beh's wuz up!");
              window.print();
            }
            else if (sign.toLowerCase() == "dan") {
              alert("Hi Master I love you!");
              window.print();
            }
            else {
             alert("Sorry I don't know you.");
             reload();   
            }
            
        });

        var totalHours = function () {
            console.log("totalHours function initialized.");


            $('.option-panel').hide();
            $('.btn-print').hide();
            $('.btn-add').hide();
        };

        var reload =  function() {
            location.reload();
        };

        var deductions = function (pay) {
            var grossVacPay = grossPay * 0.04;
            pay = grossVacPay;
            if (pay > 0) {

            var fed = pay * 0.014;
            console.log(fed);
            var pro = pay * 0.018;
            console.log(pro);
            var totalTaxDeductions = fed + pro;
            console.log(totalTaxDeductions);
            var cpp = pay * 0.0495;
            console.log(cpp);
            var ui = pay * 0.0163;
            console.log(ui);            
            var totalUIplusCPP = cpp + ui;
            console.log(totalUIplusCPP);            
            var totalAllDeductions = totalTaxDeductions + totalUIplusCPP;
            var netPay = pay - totalAllDeductions;
  

            $elTransactions.html("Total Days: " + days);
            $elFed.html("Fed: " + fed + " @ 1.4 %");
            $elPro.html("Pro: " + pro + " @ 1.8 %");
            $elTotalTax.html("Total Tax: " + totalTaxDeductions + " @ 4 %");
            $elCPP.html("CPP: " + cpp + " @ 4.95 %");
            $elUI.html("UI: " + ui + " @ 1.63 %");
            $elTotalCPPUI.html("CPP/UI: " + totalUIplusCPP);
            $elTotalDed.html("Total Deductions: " + totalAllDeductions);
            
            $elVacPay.html("Vacation Pay: " + vacPay + " @ 4 %");
            $elGrossPay.html("Gross Pay: $" + grossPay);
            $elGrossVacPay.html("Gross/Vac Total Pay: " + grossVacPay);
            $elNetPay.html("Net Pay: $" + netPay);
            $elNetVacPay.html("Net/Vac Total: $" + netVacPay);
                return netPay;
            }
        };
        var performanceTest = function (t0, t1) {

            console.log("performanceTest result: " + (t1 - t0) + " milliseconds.");
            var subTotal = t1 - t0;
            var seconds = subTotal / 1000;
            $elPerformance.html("Performance Test, time in milliseconds: " +
             subTotal + " | seconds: " + seconds);

            return subTotal;


        };

        var t1 = performance.now();


        $elPerformance.append(performanceTest(t0, t1));
        
    </script>
    <a href="http://www.cra-arc.gc.ca/E/pub/tg/t4127-jan/t4127-jan-17e.html">Canadian Payroll Deductions for Programs</a>
    <br>
    <a href="https://www.irs.gov/pub/irs-pdf/p15a.pdf">Tax Table(go to pg 31)</a>
    Over $774.00 but not over $1,812.00 subtract $372.00. Multiply result by 25%.    
</body>
</html>