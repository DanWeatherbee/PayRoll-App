<!doctype html>
<html lang="en">
  <head>
      <meta charset="utf-8 /" content="Dans app">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="robots" content="index, follow">
      <meta http-equiv="Cache-control" content="description">
      <meta http-equiv="Set-Cookie" content="name, date">
      <meta name="description" content="Dan Weatherbee's Todo in Backbone">
      <meta name="web_author" content="Dan Weatherbee Web Developer">
      <meta name="keywords" content="web developement,front end developement,front end web developement,danweatherbee,dan weatherbee,portfolio,dan weatherbee developer,danweatherby,dan weatherby,dan weatherbee web developer,dan weatherbee programmer,backbone.js">
      <meta name="author" content="Dan Weatherbee">
      <meta name="copyright" content="Dan Weatherbee">
      <meta name="contact" content="dan@jedi-clan.us">
      <meta name="reply-to" content="dan@jedi-clan.us">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="theme-color" content="#db5945">
      <meta name="msapplication-square310x310logo" content="favicon.ico">
    <title>Dan Weatherbee's Health Tracker App</title>
    <link rel="stylesheet" href="assets/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css">
  </head>
  <body>
    <script src="js/lib/jquery-3.1.1.min.js"></script>
    <!-- https://mdbootstrap.com/css/animations/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>

    <script src="js/lib/underscore-min.js"></script>
    <script src="js/lib/backbone-min.js"></script>
    <script src="js/lib/backbone-localstorage.min.js"></script>
      <section>
        <h1>
          Dan Weatherbee
        </h1>
        <h4>
          Front End Web Developer
        </h4>
      </section>
      <a href="https://www.tutorialspoint.com/backbonejs/">
        <img class="animated lightSpeedIn" src="https://www.tutorialspoint.com/backbonejs/images/backbonearch.jpg" style="height: 50%; width: 50%;" alt="Click to go to tutorialspoint.com">
      </a>

      <div id = "myVal" class="animated rotateInUpRight">
        <p>called in events with this syntax ===> [data-test]</p>
         <button id = "button" class="btn btn-primary animated rotateInUpRight" data-test = "">
            Click Here
        </button>
      </div>

      <div id = "myLog"></div>

    <script>

      var app = app || {};
      var ENTER_KEY = 13;
      var ESC_KEY = 27;
      var KEY = "b9914a3ffda1ac8218e155c05cb52409";
      var keyWord = "";
      var APPID = "ffa2c4b5";
      var API_STR_PREFIX = "https://api.nutritionix.com/v1_1/search/" + keyWord + "%20";
      var API_STR_MID = "?fields=item_name%2Citem_id%2Cbrand_name" +
              "%2Cnf_calories%2Cnf_total_fat&appId=";
      var API_STR_KEY = "&appKey=";
      var API = API_STR_PREFIX +
              keyWord +
              API_STR_MID +
              APPID +
              API_STR_KEY +
              KEY;

      $(function() {
              'use srtict'
              /*

              If jQuery is included on the page, each view has a $ function that runs queries scoped within the view's element.
              If you use this scoped jQuery function, you don't have to use the model ids as part of your query to pull out specific elements in a list, and can rely much more on the HTML class attributes.
              It is equivalent to running â€“ view.$el.find(selector).

              SYNTAX view.$(selector)

                  =================================================>
              Reference http://stackoverflow.com/
               questions/15980586/how-to-get-backbone-ajax-to-return-data-on-success


               definitions:

               The variable contains id selector as 'mydata'
              */
              var myLog = $('#mydata');

              //The variable 'data' is used to display the values
              var data = function(val) {
                      document.write('<li class="btn-item">' + val + '</li>');

              };




              var MyModel = Backbone.Model.extend({
                      defaults: {
                              title: "no data"
                      },

                      initialize: function() {
                              var foo = this.has('title');
                              this.save();
                              var bar = this.previous('title');
                              var was = this.get('title');
                              console.log(" Model has been initialized. " + foo + bar +
                                      " was: " + was);

                              this.render();
                      },

                      render: function() {

                              console.log('render was called through MyModel initialize.');

                      }
              });
              MyCollection = Backbone.Collection.extend({
                      localStorage: new Backbone.LocalStorage("database"),
                      model: MyModel,
                      initialize: function() {
                              console.log(" collection has been initialized. this.models: " + this);
                              console.log(this.models);
                              var modelsArray = [];
                              modelsArray.push(this.models);
                              console.log(" modelsArray below: ");
                              console.log(modelsArray);
                              var context = {
                                      name: 'object name'
                              };

                              _.each(modelsArray, function(element, index, list) {
                                      console.log(this); // Object {name: 'object name'}
                                      console.log(element); // array value
                                      console.log(index); // index value
                                      console.log(list); // returns array
                              }, context);

                      },

                      render: function() {

                      }

              });
              //wherever you need a collection instance
              collection = new MyCollection();

              //wherever you need to do the ajax
              Backbone.ajax({
                      dataType: "json",
                      url: API,
                      data: "",
                      success: function(searchResults) {

                              var i = 0;
                              var foodArray = [];
                              searchResults.hits.forEach(function(iterator) {
                                      console.log(searchResults.hits[i].fields.item_name);
                                      // Model
                                      itemModel = {
                                              title: searchResults.hits[i].fields.item_name,
                                              brand: searchResults.hits[i].fields.brand_name,
                                              calories: searchResults.hits[i].fields.nf_calories,
                                              fat: searchResults.hits[i].fields.nf_total_fat,
                                              id: i
                                      };

                                      foodArray.push(itemModel);
                                      i++;
                              });


                              collection.reset(foodArray); //or add
                              console.log(" ajax has initialized L81 " + collection.models[0]);
                      }
              });

              //'ViewDemo' is a name of the view class
              var ViewDemo = Backbone.View.extend({

                      //When click event occurs it activates the defined functions 'myFunc1' and 'myFunc2'
                      events: {
                              'click [data-test]': 'myFunc1',
                              'click *[data-test]': 'myFunc2'
                      },

                      //'el' uses '#myVal' as the view reference
                      el: $('#myVal'),

                      //When user clicks the button, it refers to the button defined within the 'div' tag and
                      //it will display the below statements
                      myFunc1: function() {
                              _.each(collection.models, function(element, index, list) {
                                      console.log(this); // Object {name: 'object name'}
                                      console.log(element); // array value
                                      console.log(index); // index value
                                      console.log(list); // returns array
                                      data(collection.models[index].attributes.title);
                              });

                      },

                      myFunc2: function() {
                                                    _.each(collection.models, function(element, index, list) {
                                                            console.log(this); // Object {name: 'object name'}
                                                            console.log(element); // array value
                                                            console.log(index); // index value
                                                            console.log(list); // returns array
                                                            data(collection.models[index].attributes.calories);
                                                            data(collection.models[index].attributes.fat);
                                                            data(collection.models[index].attributes.id);
                                                    }, this);

                                            }
              });

              //'myview' is an instance of the 'ViewDemo' class
              var myview = new ViewDemo();



      });
    </script>
    <a href="http://www.tutorialspoint.com/backbonejs/">Backbone Tutorials</a>
  </body>
</html>